var tobserver=function(n,q,e){function m(b,a,h){b||(b=e);a||(a=new this.ObserverTree);h||(h="");this.data=b;this.observer=a;this.path=h}function u(b){for(;-1!==b.indexOf("");)b.splice(b.indexOf(""),1);return b}function s(b){if(b.attr!==e)return b.attr;var a=b.getAttribute===e?null:b.getAttribute("tObserver");if(null===a)return null;try{a=eval("({"+a+"})")}catch(h){a=eval("("+a+")")}a.path===e&&(a.path=[""]);Array.isArray(a.path)||(a.path=[a.path]);for(var c in a.path)a.path[c]="."==a.path[c][a.path[c].length-
1]?a.path[c].slice(0,a.path[c].length-1):a.path[c],a.path[c]=""===a.path[c]?"":a.path[c];a.type=a.type===e?"innerhtml":a.type;Array.isArray(a.type)||(a.type=[a.type]);for(c in a.type)a.type[c]=a.type[c].toLowerCase();Array.isArray(a.filter)||(a.filter=[a.filter]);return b.attr=a}function v(b,a){var h=f.getData(b),c;for(c in h)if(a[c]!==e)a[c](b,h)}m.prototype.get=function(b){b=(b+"").split(".");if(0===b.length)return this;var a=b[0];if(""===a)return this;if(1===b.length)return new m(this.data===e?
e:this.data[a],this.observer,this.addNameToPath(this.path,a));b.splice(0,1);return(new m(this.data[a],this.observer,this.addNameToPath(this.path,a))).get(r(b))};m.prototype.getData=function(b){b=(b+"").split(".");b=u(b);var a=this.data,h;for(h in b)if(a[b[h]]!==e&&null!==a[b[h]])a=a[b[h]];else return e;return a};m.prototype.set=function(b,a,h){var c=(b+"").split(".");if(0===c.length)return null;if(1===c.length){if(h)return a=this.data[b].apply(this.data,a),this.notify(),a;this.data[b]!==a&&(this.data[b]=
a,this.notify(b));return this}b=c.pop();return this.get(r(c)).set(b,a,h)};m.prototype.exec=m.prototype.run=function(b,a){this.set(b,a,!0)};m.prototype.addNameToPath=function(b,a){return""===b?a:b+"."+a};m.prototype.on=function(b,a){a!==e&&(a="function"==typeof a?{update:a}:a,this.observer.addListener(a,b))};m.prototype.off=function(b,a){this.observer.removeListener(b,a)};m.prototype.notify=function(b,a){b===e&&(b="");a===e&&(a=(new Date).getTime()+""+Math.random());b=this.addNameToPath(this.path,
b);-1===this.notifyee.paths.indexOf(b)&&(this.notifyee.paths.push(b),clearTimeout(f.notifyee.timeout),f.notifyee.timeout=setTimeout(function(){f.notifyee.notify(a)},f.notifyee.speed))};m.prototype.notifyee={notify:function(b){b=this.paths;this.paths=[];for(var a in b)f.observer.runUpdate(b[a],this.round)},paths:[],timeout:0,speed:1};m.prototype.ObserverTree=function(){function b(a,b){this.$listener=[];b===e&&(b="");a!==e&&(""===b?this.$listener.push(a):this.addListener(a,b))}b.prototype.addListener=
function(a,h){var c=h.split("."),c=u(c);if(0<c.length){var d=this.toProertyname(c[0]);c.shift();this[d]===e?this[d]=new b(a,r(c)):this[d].addListener(a,r(c))}else this.$listener.push(a)};b.prototype.runUpdate=function(a,b){b===e&&(b=(new Date).getTime()+""+Math.random());a===e&&(a="");var c=u(a.split(".")),d;for(d in this.$listener)this.$listener[d].tNotificationRoundNumber!=b&&(this.$listener[d].tNotificationRoundNumber=b,this.$listener[d].update(b,c));if(0<c.length)d=this.toProertyname(c[0]),this[d]!==
e&&(c.splice(0,1),this[d].runUpdate(r(c),b));else for(var f in this)0===f.indexOf("_t_")&&this[f].runUpdate("",b)};b.prototype.removeListener=function(a,b){"undefined"===typeof a&&(a="");var c=a.split("."),c=u(c),d=this.toProertyname(c[0]);if(1<c.length||b!==e&&0<c.length)c.shift(),"undefined"!==typeof this[d]&&this[d].removeListener(r(c),b);else if(1===c.length&&this[c[0]]!==e)for(var f in this.$listener)"string"===typeof this.$listener[f].name&&this.$listener[f].name===d&&this.$listener.splice(f,
1);else if(b!==e)for(c=0;c<this.$listener.length;c++)this.$listener[c]!==b&&this.$listener[c].update!==b||this.$listener.splice(c,1)};b.prototype.toProertyname=function(a){return"_t_"+a};return b}();var t=function(){},w=function(b,a){a(b)};m.prototype.initDomViews=function(){f.utils.bindEvent(q,"DOMNodeInserted",function(b){f.findTObserver(b.srcElement)});f.utils.bindEvent(q,"DOMNodeRemoved",function(b){b.srcElement!==e&&b.srcElement.getAttribute!==e&&setTimeout(function(){var a=s(b.srcElement);a!==
e&&b.srcElement._tName!==e&&(a=a.path,a=a!==e?a:"",f.off(a+"."+b.srcElement._tName))},1E3)});this.findTObserver()};m.prototype.findTObserver=function(b){b===e&&(b=q.getElementsByTagName("html")[0]);var a=s(b),h=b.children;if(null===a)for(var c in h)f.findTObserver(h[c]);else b.attr=a,new f.StdElementView(b,this)};m.prototype.StdElementView=function(){function b(a,b){var c=s(a);if(null!==c&&a._tName===e){c.outer=c.outer!==e?c.outer:"div";c.path=""===c.path?"window":c.path;this.element=a;c.defaultValue=
[];c.preview=[];for(var d in c.type)"htmllist"===c.type[d]||"htmloption"===c.type?(c.defaultValue[d]=a.innerHTML,c.preview[d]=this.element.innerHTML,this.element.innerHTML=""):c.defaultValue[d]=a.getAttribute(c.type),"value"===c.type[d]&&this.folowElement(a);c.beforeAdd=c.beforeAdd!==e?c.beforeAdd:b.utils.stdViewBehavior.beforeAdd;c.afterAdd=c.afterAdd!==e?c.afterAdd:b.utils.stdViewBehavior.afterAdd;c.beforeRemove=c.beforeRemove!==e?c.beforeRemove:b.utils.stdViewBehavior.beforeRemove;c.afterRemove=
c.afterRemove!==e?c.afterRemove:b.utils.stdViewBehavior.afterRemove;c.beforeUpdate=c.beforeUpdate!==e?c.beforeUpdate:b.utils.stdViewBehavior.beforeUpdate;c.afterUpdate=c.afterUpdate!==e?c.afterUpdate:b.utils.stdViewBehavior.afterUpdate;var f="tObserverName"+1E16*Math.random();this.name=f;this.element._tName=f;this.element._tObserver=this;this.attr=this.element.attr=c;for(d in c.path)b.on(c.path[d],this);this.update()}}b.prototype.update=function(){var a,b,c=this.attr.path.length;c<this.attr.type.length&&
(c=this.attr.type.length);for(var d=0;d<c;d++){var l=this.attr.path[d]===e?l:this.attr.path[d],g=f.getData(l),p=g="number"===typeof g?g+"":g;b=this.attr.filter[d]===e?b:this.attr.filter[d];b!==e&&(g=b(g));g=g!==e?g:this.attr.defaultValue;a=this.attr.type[d]===e?a:this.attr.type[d];switch(a){case "innerhtml":case e:this.attr.beforeUpdate(this.element,function(a){a.innerHTML!=g&&(a.innerHTML=g,a.attr.afterUpdate(a));a.attr.afterUpdate(a)});break;case "htmllist":this.updateList(g,p);break;case "htmloption":this.updateOption(g,
p);break;case "value":this.attr.beforeUpdate(this.element,function(a){a.value!=g&&(a.value=g,a.attr.afterUpdate(a))});break;default:this.attr.beforeUpdate(this.element,function(c){if(c.style[a]===e||"src"==a){if(c.getAttribute(a)==g)return;c.setAttribute(a,g)}else{if(c.style[a]==g)return;c.style[a]=g}c.attr.afterUpdate(c)})}}};b.prototype.updateOption=function(a,b){if(!1===a)this.element.innerHTML="",this.element.display="none";else if(this.element.display="",""===this.element.innerHTML){var c=q.createElement("div");
c.innerHTML=this.attr.preview;for(this.findAndUpdatePath(c,this.attr.path);c.children[0]!==e;)this.attr.beforeAdd(c.children[0],b),this.element.appendChild(c.children[0]),this.attr.afterAdd(c.children[0],b)}};b.prototype.updateList=function(a,b){this.displayedOrdData!=b&&(this.element.innerHTML="");var c=0;this.displayedOrdData=b;for(var d=this.element.children,l=[],g=[],c=0;c<d.length;c++){var p=a.indexOf(d[c].item);-1==p?(d[c].innerHTML=d[c].innerHTML.replace("tobserver","removedtObserver").trim(),
this.attr.beforeRemove(d[c],function(a){a!==e&&(a.remove(),c--)})):(this.attr.beforeUpdate(d[c],t),l.push(d[c].item),"tobserverlistitem"==d[c].className&&(p!=d[c].position&&this.updateRootPath(d[c],this.attr.path+"."+p,this.attr.path+"."+d[c].position),d[c].position=p,g.push(d[c])))}d=q.activeElement;g.sort(function(a,c){return a.position-c.position});for(c=0;c<g.length;c++)this.element.appendChild(g[c]);d.focus();d=0;if(b!==e){for(c=0;c<a.length;c++)if(g[d]!==e&&a[c]==g[d].item)d++;else if(-1==l.indexOf(a[c])){var p=
b.indexOf(a[c]),k=q.createElement(this.attr.outer);k.setAttribute("class","tobserverlistitem");k.innerHTML=this.attr.preview;this.findAndUpdatePath(k,this.attr.path+"."+p);k.position=c;k.item=a[c];g[d]!==e?g[d].parentNode.insertBefore(k,g[d]):this.element.appendChild(k);f.findTObserver(k);this.attr.beforeAdd(k,a[c]);this.attr.afterAdd(k,a[c])}d=this.element.children}};b.prototype.findAndUpdatePath=function(a,b){var c=s(a),d=a.children;if(null===c)for(var e in d)this.findAndUpdatePath(d[e],b);else this.setRoot(a,
b)};b.prototype.setRoot=function(a,b){var c=s(a);c.path===e&&(c.path=[""]);for(var d in c.path)-1==c.path[d].indexOf(b)&&(c.path[d]=b+"."+c.path[d])};b.prototype.updateRootPath=function(a,b,c){if(a!==e&&b!==e&&c!==e){a=a.children;for(var d in a)if(a[d].attr!==e)for(var l in a[d].attr.path){var g=a[d].attr.path[l].replace(c+".","");"htmllist"==a[d].attr.type&&this.updateRootPath(a[d],g+"."+g,c+"."+g);f.off(a[d].attr.path[l]+"."+a[d]._tName);f.on(b+"."+g,a[d]._tObserver);a[d].attr.path[l]=b+"."+g}else this.updateRootPath(a[d],
b,c)}};b.prototype.folowElement=function(a){var b=function(){var b=a.attr,d;for(d in b.path)if("value"===b.type[d]){var e=a.value,h=a.getAttribute("type");null!==h&&"number"===h.toLocaleLowerCase().trim()&&parseFloat(e);f.set(b.path[d],a.value)}};a.addEventListener("change",b);a.addEventListener("keyup",b)};return b}();m.prototype.utils={stdViewBehavior:{beforeAdd:t,afterAdd:t,beforeRemove:w,afterRemove:t,beforeUpdate:w,afterUpdate:t},linkViews:function(b,a){f.on(b,new this.LinkView(a));f.on(a,new this.LinkView(b))},
linkToArrayViews:function(b,a){f.on(b,new this.LinkToArrayView(b,a));f.on(a,new this.LinkFromArrayView(b,a))},LinkView:function(b){this.update=function(a){f.notify(b,a)}},LinkToArrayView:function(b,a){this.update=function(e){var c=f.getData(b),d=f.getData(a);f.notify(a+"."+d.indexOf(c),e)}},LinkFromArrayView:function(b,a){this.update=function(h,c){var d=f.getData(b),l=f.getData(a);c[0]!==e?l[c[0]]!==d&&f.notify(b,h):f.notify(b,h)}},ArrayUpdateView:function(b,a){this.update=function(h,c){if(c[0]!==
e&&c[1]!==e){var d=c.splice(0,1),l=c.splice(0,1),g=f.getData(b+"."+d);a[l](b+"."+d,g,c)}else for(d=f.getData(b),l=0;l<d.length;l++)v(b+"."+l,a)}},registerArrayUpdateView:function(b,a){f.on(b,new f.utils.ArrayUpdateView(b,a));for(var e=f.getData(b),c=0;c<e.length;c++)v(b+"."+c,a)},ObjectUpdateView:function(b,a){this.update=function(h,c){if(c[0]!==e){var d=c.splice(0,1),l=f.getData(b);a[d](b,l,c)}else v(b,a)}},registerObjectUpdateView:function(b,a){f.on(b,new f.utils.ObjectUpdateView(b,a));v(b,a)},
history:function(){var b={},a=function(){},h={},c=Array.prototype.slice,d=Array.prototype.some,l=Array.prototype.forEach,g=Function.prototype.bind;b.bind=function(d,e){var f;if(g&&d.bind===g)return g.apply(d,c.call(arguments,1));if(!b.isFunction(d))throw new TypeError;f=c.call(arguments,2);return function(){if(!(this instanceof void 0))return d.apply(e,f.concat(c.call(arguments)));a.prototype=d.prototype;var b=new a;a.prototype=null;var h=d.apply(b,f.concat(c.call(arguments)));return Object(h)===
h?h:b}};b.bindAll=function(a){var d=c.call(arguments,1);if(0===d.length)throw Error("bindAll must be passed function names");p(d,function(c){a[c]=b.bind(a[c],a)});return a};var p=b.each=b.forEach=function(a,c,d){if(null==a)return a;var e,f;if(l&&a.forEach===l)a.forEach(c,d);else if(a.length===+a.length)for(e=0,f=a.length;e<f;e++){if(c.call(d,a[e],e,a)===h)return}else{var g=b.keys(a);e=0;for(f=g.length;e<f;e++)if(c.call(d,a[g[e]],g[e],a)===h)return}return a};b.identity=function(a){return a};b.some=
b.any=function(a,b,c){var e=!1;if(null==a)return e;if(d&&a.some===d)return a.some(b,c);p(a,function(a,d,f){if(e||(e=b.call(c,a,d,f)))return h});return!!e};var k=function(){b.bindAll(this,"checkUrl");n!==e&&(this.location=n.location,this.history=n.history)},m=/^[#\/]|\s+$/g,r=/^\/+|\/+$/g,x=/msie [\w.]+/,s=/\/$/,t=/#.*$/;k.started=!1;k.prototype.interval=50;k.prototype.atRoot=function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root};k.prototype.getHash=function(a){return(a=(a||
this).location.href.match(/#(.*)$/))?a[1]:""};k.prototype.getFragment=function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(s,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(m,"")};k.prototype.start=function(a){if(k.started)throw Error("history has already been started");k.started=!0;this.options=a===e?{}:a;this.options.root="/";this.path=this.options.path===e?"url":
this.options.path;this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var b=q.documentMode,b=x.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this.root=("/"+this.root+"/").replace(r,"/");b&&this._wantsHashChange&&(this.iframe=$('<iframe src="javascript:0" tabindex="-1">').hide().appendTo("body")[0].contentWindow,this.navigate(a));
if(this._hasPushState)$(n).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in n&&!b)$(n).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&
(this.fragment=this.getHash().replace(m,""),this.history.replaceState({},q.title,this.root+this.fragment))}$(q).on("click","a[href^='/']",function(a){var b=$(a.currentTarget).attr("href");if(!(0<=b.indexOf("sign_out")||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey))return a.preventDefault(),a=b.replace(/^\//,"").replace("#!/",""),f.utils.history.navigate(a,{trigger:!0}),!1});f.on(this.path,function(){var a=f.getData(f.utils.history.path);f.utils.router.route(a)});if(!this.options.silent)return this.loadUrl()};
k.prototype.stop=function(){$(n).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);this._checkUrlInterval&&clearInterval(this._checkUrlInterval);k.started=!1};k.prototype.route=function(a,b){this.handlers.unshift({route:a,callback:b})};k.prototype.checkUrl=function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.navigate(a);this.iframe&&this.navigate(a);this.loadUrl()};k.prototype.loadUrl=function(a){a=
this.fragment=this.getFragment(a);f.set(this.path,a)};k.prototype.navigate=function(a,b){if(!k.started)return!1;b&&!0!==b||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));a=a.replace(t,"");if(this.fragment!==a){this.fragment=a;""===a&&"/"!==c&&(c=c.slice(0,-1));if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},q.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||
this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);if(b.trigger)return this.loadUrl(a)}};k.prototype._updateHash=function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b};return new k}(),router:function(b){function a(){this.events=[];this.params=[]}a.prototype.version="0.4.2";a.prototype.route=function(a){var b=Array.prototype.slice.call(arguments,1);this.events.forEach(function(a){a.apply(this,
b)});return this};a.regexRoute=function(a,b,d,e){if(a instanceof RegExp)return a;a instanceof Array&&(a="("+a.join("|")+")");a=a.concat(e?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,d,e,f,h,l){b.push({name:f,optional:!!l});d=d||"";return""+(l?"":d)+"(?:"+(l?d:"")+(e||"")+(h||e&&"([^/.]+?)"||"([^/]+?)")+")"+(l||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+a+"$",d?"":
"i")};a.prototype.on=a.prototype.add=a.prototype.get=function(b,c){var d=this,f=[],g=a.regexRoute(b,f);this.events.push(function(a){var k=n.url.match(g);if(k){a={route:b,value:a,handler:c,params:d.params,regex:k,propagateEvent:!0,preventDefault:function(){this.propagateEvent=!1}};var m={params:{},keys:f,matches:a.regex.slice(1)};m.matches.forEach(function(a,b){m.params[f[b]&&f[b].name?f[b].name:b]=a?decodeURIComponent(a):e});c.call(d,m,a)}return d});return this};return new a}.call({},n),bindEvent:function(b,
a,e){b.addEventListener?b.addEventListener(a,e,!1):b.attachEvent&&b.attachEvent("on"+a,e)}};var r=function(b){for(var a="",e=0;e<b.length;e++)a+=(""===a?"":".")+b[e];return a},f=new m(n);return f}(window,document);tobserver.utils.bindEvent(window,"load",function(){var n=document.createElement("style");n.innerHTML=".tobserverlistitem{margin:0px;\tpadding:0px;}";document.getElementsByTagName("head")[0].appendChild(n);tobserver.initDomViews()});