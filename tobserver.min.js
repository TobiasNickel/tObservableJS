var tobserver=function(h,n,d){function f(b,a,l){b||(b=d);a||(a=new this.ObserverTree);l||(l="");this.data=b;this.observer=a;this.path=l}f.prototype.get=function(b){b=(b+"").split(".");if(0===b.length)return this;var a=b[0];if(1===b.length)return new f(this.data===d?d:this.data[a],this.observer,this.addNameToPath(this.path,a));b.splice(0,1);return(new f(this.data[a],this.observer,this.addNameToPath(this.path,a),this.rootTobservable)).get(m(b))};f.prototype.set=function(b,a,l){var c=(b+"").split(".");
if(0===c.length)return null;if(1===c.length){if(l)return a=this.data[b].apply(this.data,a),this.notify(),a;this.data[b]=a;this.notify(b);return this}b=c.pop();return this.get(m(c)).set(b,a,l)};f.prototype.run=function(b,a){this.set(b,a,!0)};f.prototype.addNameToPath=function(b,a){return""===b?a:b+"."+a};f.prototype.on=function(b,a){a!==d&&(a="function"==typeof a?{update:a}:a,this.observer.addListener(a,b))};f.prototype.off=function(b,a){this.observer.removeListener(b,a)};f.prototype.notify=function(b,
a){a===d&&(a=(new Date).getTime()+""+Math.random());this.observer.runUpdate(this.addNameToPath(this.path,b),a)};f.prototype.ObserverTree=function(){function b(a,b){this.$listener=[];b===d&&(b="");a!==d&&(""===b?this.$listener.push(a):this.addListener(a,b))}b.prototype.addListener=function(a,l){var c=l.split("."),c=this.removeEmptyStrings(c);if(0<c.length){var e=this.toProertyname(c[0]);c.shift();this[e]===d?this[e]=new b(a,m(c)):this[e].addListener(a,m(c))}else this.$listener.push(a)};b.prototype.runUpdate=
function(a,b){b===d&&(b=(new Date).getTime()+""+Math.random());a===d&&(a="");var c=this.removeEmptyStrings(a.split(".")),e;for(e in this.$listener)this.$listener[e].tNotificationRoundNumber!=b&&(this.$listener[e].tNotificationRoundNumber=b,this.$listener[e].update(b,c));if(0<c.length)e=this.toProertyname(c[0]),this[e]!==d&&(c.splice(0,1),this[e].runUpdate(m(c),b));else for(var k in this)0===k.indexOf("_t_")&&this[k].runUpdate("",b)};b.prototype.removeListener=function(a,b){"undefined"===typeof a&&
(a="");var c=a.split("."),c=this.removeEmptyStrings(c),e=this.toProertyname(c[0]);if(1<c.length||b!==d&&0<c.length)c.shift(),"undefined"!==typeof this[e]&&this[e].removeListener(m(c),b);else if(1===c.length&&this[c[0]]!==d)for(var k in this.$listener)"string"===typeof this.$listener[k].name&&this.$listener[k].name===e&&this.$listener.splice(k,1);else if(b!==d)for(c=0;c<this.$listener.length;c++)this.$listener[c]!==b&&this.$listener[c].update!==b||this.$listener.splice(c,1)};b.prototype.removeEmptyStrings=
function(a){for(;-1!==a.indexOf("");)a.splice(a.indexOf(""),1);return a};b.prototype.removeEmptyStrings=function(a){for(;-1!==a.indexOf("");)a.splice(a.indexOf(""),1);return a};b.prototype.toProertyname=function(a){return"_t_"+a};return b}();f.prototype.stdClassName="tObserver";f.prototype.initDomViews=function(){tobserver.utils.bindEvent(n,"DOMNodeInserted",function(b){tobserver.findTObserver(b.srcElement)});tobserver.utils.bindEvent(n,"DOMNodeRemoved",function(b){b.srcElement!==d&&b.srcElement.getAttribute!==
d&&setTimeout(function(){var a=b.srcElement.getAttribute("tObserver");a!==d&&b.srcElement._tName!==d&&(a=a.path,a=a!==d?a:"",tobserver.off(a+"."+b.srcElement._tName))},1E3)});this.findTObserver()};f.prototype.findTObserver=function(b){b===d&&(b=n.getElementsByTagName("html")[0]);var a=b.getAttribute===d?null:b.getAttribute("tObserver"),l=b.children;if(null===a)for(var c in l)tobserver.findTObserver(l[c]);else new tobserver.StdElementView(b,this)};f.prototype.StdElementView=function(){function b(a,
b){var c=a.getAttribute("tObserver");if(null!==c&&a._tName===d){c=eval("({"+c+"})");c.path=c.path!==d?c.path:"";c.outer=c.outer!==d?c.outer:"div";c.path="."==c.path[c.path.length-1]?c.path.slice(0,c.path.length-1):c.path;c.path=""===c.path?"window":c.path;this.element=a;"htmlList"==c.type||"htmlOption"==c.type?(c.defaultValue=a.innerHTML,c.preview=this.element.innerHTML,this.element.innerHTML=""):c.defaultValue=a.getAttribute(c.type);c.beforeAdd=c.beforeAdd!==d?c.beforeAdd:b.utils.stdViewBehavior.beforeAdd;
c.afterAdd=c.afterAdd!==d?c.afterAdd:b.utils.stdViewBehavior.afterAdd;c.beforeRemove=c.beforeRemove!==d?c.beforeRemove:b.utils.stdViewBehavior.beforeRemove;c.afterRemove=c.afterRemove!==d?c.afterRemove:b.utils.stdViewBehavior.afterRemove;c.beforeUpdate=c.beforeUpdate!==d?c.beforeUpdate:b.utils.stdViewBehavior.beforeUpdate;c.afterUpdate=c.afterUpdate!==d?c.afterUpdate:b.utils.stdViewBehavior.afterUpdate;var e="tObserverName"+1E16*Math.random();this.name=e;this.element._tName=e;this.element._tObserver=
this;this.attr=this.element.attr=c;b.on(c.path,this);this.update()}}b.prototype.update=function(){var a=tobserver.get(this.attr.path).data,b=a="number"===typeof a?a+"":a;this.attr.filter!==d&&(a=this.attr.filter(a));a=a!==d?a:this.attr.defaultValue;switch(this.attr.type){case d:this.element.innerHTML!=a&&(this.element.innerHTML=a,this.attr.afterUpdate(this.element));break;case "htmlList":this.updateList(a,b);break;case "htmlOption":this.updateOption(a,b);break;case "value":if(this.element.value==
a)break;this.element.value=a;default:if(this.element.getAttribute(this.attr.type)==a)break;this.element.setAttribute(this.attr.type,a)}};b.prototype.updateOption=function(a,b){if(!1===a)this.element.innerHTML="",this.element.display="none";else if(this.element.display="",""===this.element.innerHTML){var c=n.createElement("div");c.innerHTML=this.attr.preview;for(this.findAndUpdatePath(c,this.attr.path);c.children[0]!==d;)this.attr.beforeAdd(c.children[0],b),this.element.appendChild(c.children[0]),
this.attr.afterAdd(c.children[0],b)}};b.prototype.updateList=function(a,b){this.displayedOrdData!=b&&(this.element.innerHTML="");var c=0;this.displayedOrdData=b;for(var e=this.element.children,k=[],f=[],c=0;c<e.length;c++){var h=a.indexOf(e[c].item);-1==h?(e[c].innerHTML=e[c].innerHTML.replace("tobserver","removedtObserver").trim(),this.attr.beforeRemove(e[c],function(a){a!==d&&(a.remove(),c--)})):(this.attr.beforeUpdate(e[c],function(){}),k.push(e[c].item),"tobserverlistitem"==e[c].className&&(h!=
e[c].position&&this.updateRootPath(e[c],this.attr.path+"."+h,this.attr.path+"."+e[c].position),e[c].position=h,f.push(e[c])))}f.sort(function(a,c){return a.position-c.position});for(c=0;c<f.length;c++)this.element.appendChild(f[c]);e=0;if(b!==d){for(c=0;c<a.length;c++)if(f[e]!==d&&a[c]==f[e].item)e++;else if(-1==k.indexOf(a[c])){var h=b.indexOf(a[c]),g=n.createElement(this.attr.outer);g.setAttribute("class","tobserverlistitem");g.innerHTML=this.attr.preview;this.findAndUpdatePath(g,this.attr.path+
"."+h);g.position=c;g.item=a[c];f[e]!==d?f[e].parentNode.insertBefore(g,f[e]):this.element.appendChild(g);tobserver.findTObserver(g);this.attr.beforeAdd(g,a[c]);this.attr.afterAdd(g,a[c])}e=this.element.children}};b.prototype.findAndUpdatePath=function(a,b){var c=a.getAttribute===d?null:a.getAttribute("tObserver"),e=a.children;if(null===c)for(var f in e)this.findAndUpdatePath(e[f],b);else this.setRoot(a,b)};b.prototype.setRoot=function(a,b){var c=a.getAttribute("tObserver"),e="path:'"+b+".'+";-1==
c.indexOf(e)&&(c=c.replace("path:",e));a.setAttribute("tObserver",c)};b.prototype.updateRootPath=function(a,b,c){if(a!==d&&b!==d&&c!==d){a=a.children;for(var e in a)if(a[e].attr!==d){var f=a[e].attr.path.replace(c+".","");"htmlList"==a[e].attr.type&&this.updateRootPath(a[e],f+"."+f,c+"."+f);tobserver.off(a[e].attr.path+"."+a[e]._tName);tobserver.on(b+"."+f,a[e]._tObserver);a[e].attr.path=b+"."+f}else this.updateRootPath(a[e],b,c)}};return b}();f.prototype.utils={stdViewBehavior:function(){var b=function(){},
a=function(a,b){b(a)};return{beforeAdd:b,afterAdd:b,beforeRemove:a,afterRemove:b,beforeUpdate:a,afterUpdate:b}}(),linkViews:function(b,a){tobserver.on(b,new this.LinkView(a));tobserver.on(a,new this.LinkView(b))},linkToArrayViews:function(b,a){tobserver.on(b,new this.LinkToArrayView(b,a));tobserver.on(a,new this.LinkFromArrayView(b,a))},LinkView:function(b){this.update=function(a){tobserver.notify(b,a)}},LinkToArrayView:function(b,a){this.update=function(d){var c=tobserver.get(b).data,e=tobserver.get(a).data;
tobserver.notify(a+"."+e.indexOf(c),d)}},LinkFromArrayView:function(b,a){this.update=function(f,c){var e=tobserver.get(b).data,h=tobserver.get(a).data;c[0]!==d?h[c[0]]!==e&&tobserver.notify(b,f):tobserver.notify(b,f)}},history:function(){var b={},a=function(){},f={},c=Array.prototype.slice,e=Array.prototype.some,k=Array.prototype.forEach,m=Function.prototype.bind;b.bind=function(p,e){var d;if(m&&p.bind===m)return m.apply(p,c.call(arguments,1));if(!b.isFunction(p))throw new TypeError;d=c.call(arguments,
2);return function(){if(!(this instanceof void 0))return p.apply(e,d.concat(c.call(arguments)));a.prototype=p.prototype;var b=new a;a.prototype=null;var f=p.apply(b,d.concat(c.call(arguments)));return Object(f)===f?f:b}};b.bindAll=function(a){var e=c.call(arguments,1);if(0===e.length)throw Error("bindAll must be passed function names");q(e,function(c){a[c]=b.bind(a[c],a)});return a};var q=b.each=b.forEach=function(a,c,e){if(null==a)return a;var d,g;if(k&&a.forEach===k)a.forEach(c,e);else if(a.length===
+a.length)for(d=0,g=a.length;d<g;d++){if(c.call(e,a[d],d,a)===f)return}else{var h=b.keys(a);d=0;for(g=h.length;d<g;d++)if(c.call(e,a[h[d]],h[d],a)===f)return}return a};b.identity=function(a){return a};b.some=b.any=function(a,b,c){var d=!1;if(null==a)return d;if(e&&a.some===e)return a.some(b,c);q(a,function(a,e,p){if(d||(d=b.call(c,a,e,p)))return f});return!!d};var g=function(){b.bindAll(this,"checkUrl");h!==d&&(this.location=h.location,this.history=h.history)},r=/^[#\/]|\s+$/g,s=/^\/+|\/+$/g,t=/msie [\w.]+/,
u=/\/$/,v=/#.*$/;g.started=!1;g.prototype.interval=50;g.prototype.atRoot=function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root};g.prototype.getHash=function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""};g.prototype.getFragment=function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(u,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(r,
"")};g.prototype.start=function(a){if(g.started)throw Error("history has already been started");g.started=!0;this.options=a===d?{}:a;this.options.root="/";this.path=this.options.path===d?"url":this.options.path;this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);a=this.getFragment();var b=n.documentMode,b=t.exec(navigator.userAgent.toLowerCase())&&
(!b||7>=b);this.root=("/"+this.root+"/").replace(s,"/");b&&this._wantsHashChange&&(this.iframe=$('<iframe src="javascript:0" tabindex="-1">').hide().appendTo("body")[0].contentWindow,this.navigate(a));if(this._hasPushState)$(h).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in h&&!b)$(h).on("hashchange",this.checkUrl);else this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&
!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&a.hash&&(this.fragment=this.getHash().replace(r,""),this.history.replaceState({},n.title,this.root+this.fragment))}$(n).on("click","a[href^='/']",function(a){var b=$(a.currentTarget).attr("href");if(!(0<=b.indexOf("sign_out")||a.altKey||a.ctrlKey||a.metaKey||a.shiftKey))return a.preventDefault(),a=b.replace(/^\//,"").replace("#!/",""),tobserver.utils.history.navigate(a,
{trigger:!0}),!1});if(!this.options.silent)return this.loadUrl()};g.prototype.stop=function(){$(h).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);this._checkUrlInterval&&clearInterval(this._checkUrlInterval);g.started=!1};g.prototype.route=function(a,b){this.handlers.unshift({route:a,callback:b})};g.prototype.checkUrl=function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.navigate(a);this.iframe&&
this.navigate(a);this.loadUrl()};g.prototype.loadUrl=function(a){a=this.fragment=this.getFragment(a);tobserver.set(this.path,a)};g.prototype.navigate=function(a,b){if(!g.started)return!1;b&&!0!==b||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));a=a.replace(v,"");if(this.fragment!==a){this.fragment=a;""===a&&"/"!==c&&(c=c.slice(0,-1));if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},n.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,
b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);if(b.trigger)return this.loadUrl(a)}};g.prototype._updateHash=function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b};return new g}(),bindEvent:function(b,a,d){b.addEventListener?b.addEventListener(a,d,!1):b.attachEvent&&b.attachEvent("on"+a,d)}};var m=
function(b){for(var a="",d=0;d<b.length;d++)a+=(""===a?"":".")+b[d];return a};return new f(h)}(window,document);tobserver.utils.bindEvent(window,"load",function(){var h=document.createElement("style");h.innerHTML=".tobserverlistitem{margin:0px;\tpadding:0px;}";document.getElementsByTagName("head")[0].appendChild(h);tobserver.initDomViews()});